{%- if section.settings.fullwidth -%}
  {%- assign container = 'container-full' -%}
{%- elsif section.settings.max_width != blank -%}
  {%- assign container = 'bwp-container' -%}
{%- else -%}
  {%- assign container = 'container' -%}
{%- endif -%}

{%- assign max_width = '' -%}
{%- if section.settings.fullwidth == blank and section.settings.max_width != blank -%}
  {%- capture max_width -%}style="max-width: {{ section.settings.max_width }};"{%- endcapture -%}
{%- endif -%}

{% assign margin  = section.settings.margin | split: "|" %}
{% assign padding = section.settings.padding | split: "|" %}

{%- style -%}
#shopify-section-{{ section.id }} .kretoss-section--after-before{
  {% if margin[0] != blank %}margin: {{ margin[0] }};{% endif %}
  {% if padding[0] != blank %}padding: {{ padding[0] }};{% endif %}
}
@media(max-width:1200px){
  #shopify-section-{{ section.id }} .kretoss-section--after-before{
    {% if margin[1] != blank %}margin: {{ margin[1] }};{% endif %}
    {% if padding[1] != blank %}padding: {{ padding[1] }};{% endif %}
  }
}
@media(max-width:991px){
  #shopify-section-{{ section.id }} .kretoss-section--after-before{
    {% if margin[2] != blank %}margin: {{ margin[2] }};{% endif %}
    {% if padding[2] != blank %}padding: {{ padding[2] }};{% endif %}
  }
}
@media(max-width:767px){
  #shopify-section-{{ section.id }} .kretoss-section--after-before{
    {% if margin[3] != blank %}margin: {{ margin[3] }};{% endif %}
    {% if padding[3] != blank %}padding: {{ padding[3] }};{% endif %}
  }
}
{%- endstyle -%}

<section class="kretoss-section kretoss-section--after-before {{ section.settings.custom_class }}">
  <div class="{{ container }}" {{ max_width }}>
    <div class="kretoss-section__inner">
      <div class="after_before_inner" style="background-color: {{ section.settings.color_bg }};">
       <div class="after_before_content">
             <h2>
                {{ section.settings.heading }}
                <span>{{ section.settings.highlight_text }}</span>
            </h2>
            <p>{{ section.settings.description }}</p>
        </div>
        <div class="after_before_carousel">
            <div class="bwp_slider-carousel">
                <div class="js-carousel slick-carousel" data-nav="false" data-dots="false" data-infinite="false"
                    data-autoplay="false"
                    data-autoplayspeed="5000"
                    data-columns="1"
                    data-column1440="1"
                    data-column1="1"
                    data-column2="1"
                    data-column3="1"
                    data-column4="1">
                    <div class="slick-carousel__item">
                        <div class="after_before_card" data-block>
                            <img src="https://cdn.shopify.com/s/files/1/0656/8352/1634/files/before_img_new.png?v=1766571206" class="before-img" />
                            <img src="https://cdn.shopify.com/s/files/1/0656/8352/1634/files/after_img_new.png?v=1766571206" class="after-img" />
                            <div class="slider" data-slider></div>
                        </div>
                    </div>
                    <div class="slick-carousel__item">
                        <div class="after_before_card" data-block>
                            <img src="https://cdn.shopify.com/s/files/1/0656/8352/1634/files/before11.png?v=1765456064" class="before-img" />
                            <img src="https://cdn.shopify.com/s/files/1/0656/8352/1634/files/after1.png?v=1765453769" class="after-img" />
                            <div class="slider" data-slider></div>
                        </div>
                    </div>
                    <div class="slick-carousel__item">
                        <div class="after_before_card" data-block>
                            <img src="https://cdn.shopify.com/s/files/1/0656/8352/1634/files/before11.png?v=1765456064" class="before-img" />
                            <img src="https://cdn.shopify.com/s/files/1/0656/8352/1634/files/after1.png?v=1765453769" class="after-img" />
                            <div class="slider" data-slider></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
document.querySelectorAll('[data-block]').forEach(block => {
  const slider = block.querySelector('[data-slider]');
  const afterImg = block.querySelector('.after-img');

  let isDragging = false;

  const moveSlider = (e) => {
    if (!isDragging) return;

    const rect = block.getBoundingClientRect();
    let x = e.clientX - rect.left;

    x = Math.max(0, Math.min(x, rect.width));

    slider.style.left = x + 'px';

    /* ✅ KEY FIX — clip from LEFT only */
    afterImg.style.clipPath = `inset(0 0 0 ${x}px)`;
  };

  slider.addEventListener('mousedown', () => isDragging = true);
  window.addEventListener('mouseup', () => isDragging = false);
  window.addEventListener('mousemove', moveSlider);
});
</script>


{% schema %}
{
  "name": "After Before Carousel",
  "class": "kretoss-unique-about",
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom Class"
    },
    {
      "type": "color",
      "id": "color_bg",
      "label": "Background Color",
      "default": "#f5f5f5"
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Max Width",
      "info": "Example: 1440px"
    },
    {
      "type": "checkbox",
      "id": "fullwidth",
      "label": "Full Width"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "You can find your own"
    },
    {
      "type": "text",
      "id": "highlight_text",
      "label": "Highlighted Text",
      "default": "Beauty"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "text",
      "id": "padding",
      "label": "Padding",
      "info": "Desktop | 1200px | 991px | 767px"
    },
    {
      "type": "text",
      "id": "margin",
      "label": "Margin",
      "info": "Desktop | 1200px | 991px | 767px"
    }
  ],
  "presets": [
    {
      "name": "After Before Carousel"
    }
  ]
}

{% endschema %}

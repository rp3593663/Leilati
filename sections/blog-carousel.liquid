{%- if section.settings.fullwidth -%}
  {%- assign container = 'container-full' -%}
{%- elsif section.settings.max_width != blank -%}
  {%- assign container = 'bwp-container' -%}
{%- else -%}
  {%- assign container = 'container' -%}
{%- endif -%}

<section class="kretoss-section kretoss-section--blog-carousel {{ section.settings.custom_class }}" style="background-color: {{ section.settings.color_bg }};">
  <div class="{{ container }}" {% if section.settings.max_width != blank %}style="max-width:{{ section.settings.max_width }}"{% endif %}>

    {% assign blog = blogs[section.settings.blog] %}
    {% if blog != blank %}

    <!-- MAIN FEATURE -->
    <div class="blog-carousel-wrapper">
      {% assign first_article = blog.articles.first %}

      <div class="blog-main">
        <div class="blog-main-image">
            <div class="blog_img">
                <img id="mainBlogImage" src="{{ first_article.image | image_url: width: 900 }}" alt="{{ first_article.title }}">
            </div>
            <div id="mainBlogDate">{{ first_article.published_at | date: "%b - %d" }}</div>
        </div>

        <div class="blog-main-content">
          <span class="blog-author">{{ first_article.author }}</span>
          <h2 id="mainBlogTitle">{{ first_article.title }}</h2>
          <p id="mainBlogExcerpt">{{ first_article.excerpt | strip_html | truncate: 160 }}</p>
          <a id="mainBlogLink" href="{{ first_article.url }}" class="btn">
            Read More
          </a>
        </div>
      </div>

      <!-- THUMBNAILS -->
      <div class="blog-thumbnails">
        <div class="js-carousel slick-carousel" data-nav="false" data-dots="true" data-infinite="false"
						data-autoplay="false"
						data-autoplayspeed="2000"
						data-columns="4"
						data-column1440="4"
						data-column1="4"
						data-column2="3"
						data-column3="3"
						data-column4="3">
            {% for article in blog.articles %}
                <div class="slick-carousel__item">
                    <div class="blog-thumb {% if forloop.first %}active{% endif %}" data-title="{{ article.title | escape }}"  data-excerpt="{{ article.excerpt | strip_html | truncate: 160 | escape }}" data-image="{{ article.image | image_url: width: 900 }}" data-url="{{ article.url }}" data-author="{{ article.author }}">
                        <img src="{{ article.image | image_url: width: 300 }}" alt="{{ article.title }}">
                    </div>
                </div>
            {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</section>

<script>
document.querySelectorAll('.blog-thumb').forEach(thumb => {
  thumb.addEventListener('click', () => {
    document.querySelectorAll('.blog-thumb').forEach(t => t.classList.remove('active'));
    thumb.classList.add('active');

    document.getElementById('mainBlogImage').src = thumb.dataset.image;
    document.getElementById('mainBlogTitle').innerText = thumb.dataset.title;
    document.getElementById('mainBlogExcerpt').innerText = thumb.dataset.excerpt;
    document.getElementById('mainBlogLink').href = thumb.dataset.url;
  });
});
</script>

{% schema %}
{
  "name": "Blog Carousel",
  "settings": [
    {
      "type": "blog",
      "id": "blog",
      "label": "Select Blog"
    },
    {
      "type": "color",
      "id": "color_bg",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Max Width",
      "info": "Example: 1440px"
    },
    {
      "type": "checkbox",
      "id": "fullwidth",
      "label": "Full Width"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom CSS Class"
    }
  ],
  "presets": [
    {
      "name": "Blog Carousel"
    }
  ]
}
{% endschema %}
